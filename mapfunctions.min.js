function MapFunctions(p,n){"string"==typeof p&&(p=document.querySelector(p));var h,m,f,v,r,g,C,d,a,l,o,s,c,u,y,i,b,E,k,x,w,S,M,O=0,T=!1,P=L.layerGroup(),D=new L.MarkerClusterGroup({spiderfyDistanceMultiplier:2}),A=L.layerGroup(),I=(L.layerGroup(),[]),N=[],J=!1;function B(){return g&&C?{lat:parseFloat(g.toFixed(5)),lng:parseFloat(C.toFixed(5))}:null}function G(t,e){e&&(x=e);var t=null==t?h.value:t,t="https://nominatim.openstreetmap.org/search/"+encodeURIComponent(t)+"?format=json",i=new XMLHttpRequest;i.open("GET",t),i.setRequestHeader("Content-Type","application/json"),i.send(),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=JSON.parse(i.responseText),e=document.createElement("h3");e.textContent="Pick a location from the options bellow:",v.firstChild||v.appendChild(e),v.removeChild(v.firstChild),r=document.createElement("div");e=document.createElement("h3");e.textContent="Choose a location",r.append(e);for(var n=0;n<t.length;n++){var a=t[n].display_name,o=document.createElement("div");o.textContent=a,o.dataset.lat=t[n].lat,o.dataset.lng=t[n].lon,o.classList.add("locationsCss"),o.addEventListener("click",function(){x._container.scrollIntoView({block:"start",behavior:"smooth"})}),r.appendChild(o),n===t.length-1&&(v.appendChild(r),U())}}}}function U(){for(var t=r.children,e=0;e<t.length;e++)t[e].addEventListener("click",function(){g=parseFloat(this.dataset.lat),C=parseFloat(this.dataset.lng),d=this.textContent,l&&q(),F(g,C,d,!0)})}function R(t,o){(x=t?t:x).locate(),x.on("locationfound",function(t){g=t.latlng.lat,C=t.latlng.lng;let e=document.createElement("div"),n=document.createElement("p");n.textContent=`Your current location: ${t.latlng.lat}, ${t.latlng.lng}`,n.style.color="#000",e.appendChild(n);let a=document.createElement("button");a.classList.add(".btngreen"),a.textContent="Save this location?",a.addEventListener("click",function(t){t.preventDefault(),o()}),e.appendChild(a),F(t.latlng.lat,t.latlng.lng,e,!0),q([{lat:t.latlng.lat,lng:t.latlng.lng},{lat:g,lng:C}]),p.scrollIntoView({block:"start",behavior:"smooth"})}),x.on("locationerror",function(t){})}function F(t,e,n,a){function o(t,e,n,a){var o=L.marker([t,e],{draggable:n}).addTo(a);o.on("moveend",function(){var t=o.getLatLng();F(t.lat,t.lng,"New position",P)});n=document.createElement("p");for(n.textContent="Your coordinates: "+t+","+e;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(n),a.addTo(x),x.setView([t,e],11),null!==d&&(o.bindPopup(d).openPopup(),"undefined"!=typeof folder2&&folder2.reattachEvents())}void 0!==e&&(C=e),void 0!==n&&(d=n),typeof(g=void 0!==t?t:g)===String&&(g=parseFloat(g)),typeof C===String&&(C=parseFloat(C)),a?(P.clearLayers(),o(g,C,!1,P)):(D.clearLayers(),o(g,C,!1,D))}function H(l,s,t,e,n,c){return n&&x.addEventListener("click",function(t){var e,n,a,o,i,r,d;e=l,n=B(),a=s,o=e.lat,i=e.lng,r=n.lat,d=n.lng,e=o*Math.PI/180,n=r*Math.PI/180,o=(r-o)*Math.PI/180,i=(d-i)*Math.PI/180,i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e)*Math.cos(n)*Math.sin(i/2)*Math.sin(i/2),i=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),(u=!(6371e3*i>1e3*parseInt(a)))||(swiftmoAlert?swiftmoAlert.setContent(c).toggle():alert(c))}),o&&x.removeLayer(o),o=l?L.circle(l,1e3*s):(el=p,L.circle(JSON.parse(el.dataset.coordinates),parseInt(1e3*el.dataset.radius))),e&&o.addTo(x),o}function q(t,n,e){t=t||[JSON.parse(p.dataset.coordinates),{lat:g,lng:C}];var a,o;p.dataset.coordinates;E=t[0],w&&w.getPlan().setWaypoints([]),a="https://routing.swiftmo.com",o="routing",(w=L.Routing.control({serviceUrl:a,timeout:5e3,profile:o,show:!1,waypoints:t,draggableWaypoints:n,routeWhileDragging:e,createMarker:function(t,e){return L.marker(e.latLng,{draggable:n}).addTo(D)},lineOptions:{styles:[{color:"blue",opacity:1,weight:4,width:"4px"}]}})).on("routingerror",function(t){swiftmoAlert.setContent("Ops, we couldn't find a route between these points").toggle()}),w.on("routeselected",function(t){var e,n,a,o;s=2*(t.route.summary.totalDistance/1e3).toFixed(2),traveltime=(e=s,n=90,e=parseInt(e*n,10),a=Math.floor(e/3600),o=Math.floor(e/60)%60,n=e%60,(e=function(t){return 1===t.toString().length&&t===o?":0":1===t.toString().length&&t===a?"0":":"})(a)+a+e(o)+o+":"+n),c=parseInt(p.dataset.travelcharge*s);var i="This requires a "+s+" km return trip taking about "+traveltime+" h.";0!=p.dataset.travelcharge&&(i+=" This has an added cost of €"+(c/100).toFixed(2)+".");(t.route.summary.totalDistance/1e3).toFixed(1);D._needsClustering[1].bindPopup(L.popup({autoPan:!1}).setContent(function(){var t=document.createElement("div"),e=document.createElement("p");e.textContent=i,t.appendChild(e);e=document.createElement("button");e.classList.add("btn","sms2","autosave","btnnext","confirmDelivery"),e.setAttribute("type","button"),e.dataset.pageid="6",e.textContent="Confirm delivery",t.appendChild(e);e=document.createElement("span");return e.classList.add("glyphicon","glyphicon-ok","conftick2"),t.appendChild(e),t}())).openPopup();var r=document.createElement("div");r.classList.add("emphasis");t=document.createElement("p");t.textContent=i,r.appendChild(t);t=document.createElement("button");t.classList.add("btn","sms2","autosave","btnnext","confirmDelivery"),t.setAttribute("type","button"),t.dataset.pageid="6",t.textContent="Confirm delivery",r.appendChild(t);t=document.createElement("span");for(t.classList.add("glyphicon","glyphicon-ok","conftick2"),r.appendChild(t);v.firstChild;)v.removeChild(v.firstChild);v.appendChild(r)}).addTo(x)}function z(t){var n=[];if("string"==typeof t&&(t=JSON.parse(t)),!1===T)(S=document.createElement("select")).classList.add("rentalTypeSelect"),m.append(S),(M=document.createElement("option")).setAttribute("disabled",!0),M.setAttribute("selected",!0),M.textContent="Select activity type:",S.appendChild(M),T=!0,e(t);else{for(;1<S.children.length;)S.removeChild(S.lastChild);e(t)}function e(t){t.forEach(function(t){t.data.services.forEach(function(t){var e;!1===n.includes(t)&&((e=document.createElement("option")).setAttribute("value",t),e.textContent=t,S.appendChild(e),n.push(t))})}),S.addEventListener("change",function(t){for(var e=I.length-1;0<=e;--e)t.target.value===I[e].type?I[e].providerMarkers.forEach(function(t){D.addLayer(t)}):I[e].providerMarkers.forEach(function(t){D.removeLayer(t)})})}}function j(t){var n,a,e="object"!=typeof t?JSON.parse(t):t;a=[],(n=e).forEach(function(t,e){t.data.services.forEach(function(t){a.push(t)}),e===n.length-1&&(document.querySelectorAll(".sportCardContainer").forEach(function(t,e){t.style.display="none"}),function(t){for(var e=[],n=0,a=t.length;n<a;n++)-1===e.indexOf(t[n])&&""!==t[n]&&e.push(t[n]);return e}(a).forEach(function(t){document.querySelectorAll("[id='"+t+"']").forEach(function(t){t.style.display="block"})}))});for(var o=0;o<e.length;o++){if(e[o].data.services.length<=1)W(e[o],0);else for(var i=0;i<e[o].data.services.length;i++)W(e[o],i);o===e.length-1&&(D.addTo(x),A.addTo(x),"undefined"!=typeof folder&&folder.reattachEvents())}0===e.length&&(D.clearLayers(),I.length=0)}function V(t,n,e){var a=x.getBounds();xhr({coordinates:a,sport:t,cards:n},e,function(t){var e;n?(document.getElementById("supplierCardCollection").innerHTML=t,document.getElementById("supplierCardCollection").firstChild.dataset.supplierdata?(j(e=JSON.parse(document.getElementById("supplierCardCollection").firstChild.dataset.supplierdata)),z(e)):z([])):(j(t),z(t))})}function W(t,n){var a={};1===t.data.shop.pickup&&(a.data=JSON.parse(JSON.stringify(t.data.shop)),a.data["location-decimal-coordinates"]=t.data.shop["location-decimal-coordinates"]),1===t.data.shop.pickup&&1===t.data.delivery.willtravel&&(a.data=JSON.parse(JSON.stringify(t.data)),a.data["location-decimal-coordinates"]=t.data.shop["location-decimal-coordinates"]),0===t.data.shop.pickup&&1===t.data.delivery.willtravel&&(a.data=JSON.parse(JSON.stringify(t.data.delivery)),a.data["location-decimal-coordinates"]=t.data.delivery["location-decimal-coordinates"]),a.provider=t.provider,a.services=t.data.services,a.verificationcode=t.data.verificationcode;var e=a.data.verificationcode,o=a.data.services[n],t=JSON.stringify(a.data["location-decimal-coordinates"]),i=e+"-"+o+"-"+t;function r(){var t,e;!1===N.includes(i)&&(t=a.data["location-decimal-coordinates"].lat,e=a.data["location-decimal-coordinates"].lng,a.coordinates={lat:t,lng:e},(e=L.circleMarker(a.coordinates,{zIndexOffset:1e3,color:"race bike rental"===(e=a.data.services[n])?"blue":"mountain bike rental"===e?"green":void 0})).bindPopup(L.popup({autoPan:!1}).setContent(function(n,t){var e=L.DomUtil.create("div"),a=L.DomUtil.create("h3");a.textContent=n.provider,e.appendChild(a);var o,i=L.DomUtil.create("p"),r=n.data.services[t].replace(/-/g," ");i.textContent=r.charAt(0).toUpperCase()+r.slice(1),e.appendChild(i),_(a=L.DomUtil.create("button","sms2"),["btn","bounceOnHover","mapbtn"]),a.setAttribute("data-guide","card-"+n.data.verificationcode+"-"+n.data.services[t]),a.setAttribute("data-providerCode",n.data.verificationcode),a.textContent="Read more ~",e.appendChild(a),a.addEventListener("click",function(t){var e=encodeURI(window.location.origin+"/provider?alias="+n.data.alias);window.location.replace(e)}),n.data.radius&&((o=L.DomUtil.create("button","sms2")).textContent="Activity radius",_(o,["btn","bounceOnHover","radius"]),Y(o,n),e.appendChild(o)),(r=L.DomUtil.create("button","sms2")).textContent="Check route",_(r,["btn","bounceOnHover","checkRoute"]),r.dataset.coordinates=JSON.stringify(n.coordinates),e.appendChild(r),1===n.data.delivery.willtravel&&((i=L.DomUtil.create("button","sms2")).textContent="Delivery Radius",_(i,["btn","bounceOnHover","deliveryRadius"]),a=n.data.delivery["location-decimal-coordinates"],o=n.data.delivery.radius,i.dataset.coordinates=JSON.stringify(a),i.dataset.radius=o,Y(i,{coordinates:a,data:{radius:o}}),e.appendChild(i)),y?((l=L.DomUtil.create("button","sms2")).textContent="next",_(l,["btn","sms2","bounceOnHover","bookguideBtn"]),l.dataset.code=n.data.verificationcode,l.dataset.sport=n.data.services[t]):((l=L.DomUtil.create("button","sms2")).textContent="next",_(l,["btn","sms2","bounceOnHover","btnnext","providers","hirechoice","selectProvider"]),l.dataset.pageid="1",l.dataset.provider=n.provider,l.dataset.hirechoice=n.data.services[t]),e.appendChild(l);var d=L.DomUtil.create("div");_(d,["alertdiv"]),e.appendChild(d);var l=L.DomUtil.create("p");return l.textContent="Please search for a location to route in the panel above",d.appendChild(l),d.style.display="none",r.addEventListener("click",function(){void 0===g||void 0===C?d.style.display="block":q([n.coordinates,{lat:g,lng:C}],!1,!1)}),e}(a,n))).openPopup(),I.push({type:o,providerMarkers:[e]}),e.addTo(D),N.push(i),madeMarkersG=I)}0===I.length?r():I.find(function(t){t.type===o||r()})}function _(t,e){for(var n=0;n<e.length;n++)L.DomUtil.addClass(t,e[n])}function Y(t,e){var n=1;e.radius||(e.radius=1);var a=H(e.coordinates,parseInt(e.data.radius));t.addEventListener("click",function(){n%2?a.addTo(A):a.removeFrom(A),n++})}this.dataRoute=function(t,e,n){var a,o,i;return a=t,o=e,i=n,x.on("load",function(t){V(a,o,i)}),x.on("moveend",function(t){V(a,o,i),0<x.offsetWidth&&x.offsetHeight}),x.on("resize",function(t){0<x.offsetWidth&&0<x.offsetHeight&&V(a,o,i)}),this},this.map=function(){return x},this.notnext=function(){return y=!0,this},this.removeMap=function(){x.remove()},this.mapcanvas=L.canvas({}),this.generateMap=function(t){var e;return!1===J&&(e=document.createElement("div"),p.appendChild(e),b=document.createElement("div"),e.appendChild(b),e.style.height=n,e.style.width="100%",x=L.map(e,{layers:[L.tileLayer(t,{attribution:"<a href='https://www.mapbox.com/about/maps/'>Mapbox</a> © <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>"})],preferCanvas:!0,center:[37.09681,-8.41965],zoom:11}),L.control.scale().addTo(x).setPosition("bottomright")),J=!0,this},this.invalidateSize=function(){return x.invalidateSize()},this.returnBounds=function(){return x.getBounds()},this.returnCoordinates=B,this.reverseGeocode=function(t){return function(){var t="https://nominatim.openstreetmap.org/reverse?format=json&lat="+B().lat+"&lon="+B().lng+"&zoom=18&addressdetails=1",e=new XMLHttpRequest;return e.open("GET",t),e.setRequestHeader("Content-Type","application/json"),e.send(),e.onreadystatechange=function(){var t;4===e.readyState&&200===e.status&&(t=JSON.parse(e.responseText),i=t.display_name)},this}()},this.searchLocation=G,this.attachEvents=U,this.assembleButtons=function(t,e,n,a,o,i,r,d,l,s,c){t=document.querySelector(t),(m=t).classList.add("emphasis","center"),(v=document.createElement("div")).classList.add("locationOptions"),l&&((u=document.createElement("h2")).classList.add("center","findaguide","item"),u.textContent=l,t.appendChild(u));l=document.createElement("div");l.classList.add("emphasis","block");var u=document.createElement("p");return u.textContent=s,t.appendChild(l),l.appendChild(u),i&&(meetGuide=document.createElement("button"),meetGuide.classList.add("btn","sms2","item","guidePoint","block","center"),meetGuide.textContent="Meet guide at their meetup point",meetGuide.setAttribute("type","button"),meetGuide.addEventListener("click",function(t){t.preventDefault();var e=JSON.parse(p.dataset.coordinates);g=e[0],C=e[1],k="guidePoint";var n="Coordinates to meet at: "+B().lat+","+B().lng+". Link with directions: ",t=document.createElement("p");t.textContent=n;e=document.createElement("a"),n="https://www.google.com/maps/dir//"+B().lat+","+B().lng;e.setAttribute("href",n),e.setAttribute("target","_blank"),e.textContent="https://www.google.com/maps/dir//"+B().lat+","+B().lng,document.getElementById("coordinates").appendChild(t),t.appendChild(e),e.style.textAlign="center",document.querySelector("#coordinates").scrollIntoView({block:"start",behavior:"smooth"}),document.querySelector("#coordinates").classList.add("infodiv","bounce")}),t.appendChild(meetGuide)),e&&((h=document.createElement("input")).setAttribute("type","text"),h.classList.add("clientLocation","bookguide","item"),h.setAttribute("placeholder","Enter address"),(f=document.createElement("button")).classList.add("btn","btn-primary","sms2","btn-lg"),f.textContent="Search",f.setAttribute("type","button"),n&&(f.id=n),f.addEventListener("click",function(t){t.preventDefault(),k="searchedLocation",G(null,d)}),t.appendChild(h),t.appendChild(f),t.appendChild(v)),a&&(locationBtn=document.createElement("button"),locationBtn.classList.add("btn","sms2","bounceOnHover","item"),locationBtn.textContent="Get your current location",locationBtn.setAttribute("type","button"),o&&(locationBtn.id=n),locationBtn.addEventListener("click",function(t){t.preventDefault(),r?(k="currentLocation",R(x,c)):(k="currentLocation",R(d,c))}),t.appendChild(locationBtn)),this},this.geoCodeResult=function(){return i},this.locate=function(t){return R(t,saveFunction),this},this.swapMarker=function(t,e,n,a){return F(t,e,n,a),this},this.test=function(){D.clearLayers()},this.meetUp=function(){return k},this.addGuideRadius=function(t,e,n,a,o,i){return H(t,e,0,a,o,i),this},this.distance=function(){return s},this.locationValid=function(){return u},this.travelTime=function(){},this.travelCost=function(){return c},this.enableRouting=function(){return l=!0,this},this.returnProviderCoordinates=function(){return E},this.route=function(t,e,n){return q(t,e,n),this},this.addGuideMarker=function(t,e){return function(t,e){void 0===e&&(e="This guide's meetup point");guidePoint=t?(a=L.marker(t,{draggable:!1}).addTo(x),a.bindPopup(e).openPopup()):(a=L.marker(JSON.parse(p.dataset.coordinates),{draggable:!1}).addTo(x),a.bindPopup("This guide's meetup point").openPopup())}(t,e),this},this.locateOnClick=function(t,e,n,a){var o,i,r;return o=t,i=e,r=n,x.addEventListener("click",function(a){if(i&&x.removeLayer(i),0===O){g=a.latlng.lat,C=a.latlng.lng,k="mapClick";let t=document.createElement("div"),e=document.createElement("p");e.textContent=`Your chosen location: ${a.latlng.lat}, ${a.latlng.lng}`,e.style.color="#000",t.appendChild(e);let n=document.createElement("button");n.classList.add(".btngreen"),n.textContent="Save this location?",n.addEventListener("click",function(t){t.preventDefault(),r()}),t.appendChild(n),i&&(radius=parseInt(1e3*document.getElementById("trainingradius").value),i=L.circle({lat:a.latlng.lat,lng:a.latlng.lng},radius).addTo(x)),o&&F(g,C,t)}else g=a.latlng.lat,C=a.latlng.lng,d="Your current location",!0===i&&(radius=parseInt(1e3*document.getElementById("trainingradius").value),i=L.circle({lat:a.latlng.lat,lng:a.latlng.lng},radius).addTo(x)),!0===o&&F(),!0===r&&mapfunctions.saveLocation("coordinates",JSON.stringify({lat:a.latlng.lat,lng:a.latlng.lng}));l&&q([JSON.parse(p.dataset.coordinates),{lat:a.latlng.lat,lng:a.latlng.lng}])}),this},this.loadProvidersAndSports=function(t,e,n){return V(t,e,n),this},this.makeSpecificMarker=function(t){makeMarkers2(t,0)},this.loadMarkers=function(t,e){return j(t),this},this.typeDropdown=function(t){return z(t),this}}