function MapFunctions(u,n){var p,h,m,g,r,f,v,l,o,s,a,d,c,y,C,i,b,E,k,S,x,w,O,M=0,N=!1,T=L.layerGroup(),P=new L.MarkerClusterGroup({spiderfyDistanceMultiplier:2}),J=L.layerGroup(),I=(L.layerGroup(),[]),q=[],A=!1;function D(){return f&&v?{lat:parseFloat(f.toFixed(5)),lng:parseFloat(v.toFixed(5))}:null}function U(t,e){e&&(S=e);var t=null==t?p.value:t,t="https://nominatim.openstreetmap.org/search/"+encodeURIComponent(t)+"?format=json",i=new XMLHttpRequest;i.open("GET",t),i.setRequestHeader("Content-Type","application/json"),i.send(),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=JSON.parse(i.responseText),e=document.createElement("h3");e.textContent="Pick a location from the options bellow:",g.firstChild||g.appendChild(e),g.removeChild(g.firstChild),r=document.createElement("div");e=document.createElement("h3");e.textContent="Choose a location",r.append(e);for(var n=0;n<t.length;n++){var o=t[n].display_name,a=document.createElement("div");a.textContent=o,a.dataset.lat=t[n].lat,a.dataset.lng=t[n].lon,a.classList.add("locationsCss"),a.addEventListener("click",function(){console.log("scroll evt 177"),S._container.scrollIntoView({block:"start",behavior:"smooth"})}),r.appendChild(a),n===t.length-1&&(g.appendChild(r),B())}}}}function B(){for(var t=r.children,e=0;e<t.length;e++)t[e].addEventListener("click",function(){f=parseFloat(this.dataset.lat),v=parseFloat(this.dataset.lng),l=this.textContent,s&&F(),R(f,v,l,!0)})}function G(t){(S=t?t:S).locate(),console.log("before"),S.on("locationfound",function(t){console.log("location found"),f=t.latlng.lat,v=t.latlng.lng,R(t.latlng.lat,t.latlng.lng,"Your current location",!0),F([{lat:t.latlng.lat,lng:t.latlng.lng},{lat:f,lng:v}]),console.log("scroll evt 341"),document.querySelector(u).scrollIntoView({block:"start",behavior:"smooth"})}),S.on("locationerror",function(t){console.log("there was an error: "+t.message+t.code)})}function R(t,e,n,o){function a(t,e,n,o){var a=L.marker([t,e],{draggable:n}).addTo(o);a.on("moveend",function(){var t=a.getLatLng();R(t.lat,t.lng,"New position",T)});n=document.createElement("p");for(n.textContent="Your coordinates: "+t+","+e;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(n),o.addTo(S),S.setView([t,e],11),null!==l&&(a.bindPopup(l).openPopup(),"undefined"!=typeof folder2&&folder2.reattachEvents())}void 0!==e&&(v=e),void 0!==n&&(l=n),typeof(f=void 0!==t?t:f)===String&&(f=parseFloat(f)),typeof v===String&&(v=parseFloat(v)),console.log("lat"+f),o?(T.clearLayers(),a(f,v,!1,T)):(P.clearLayers(),a(f,v,!1,P))}function H(s,d,t,e,n,c){return console.log([...arguments]),n&&S.addEventListener("click",function(t){var e,n,o,a,i,r,l;e=s,n=D(),o=d,a=e.lat,i=e.lng,r=n.lat,l=n.lng,e=a*Math.PI/180,n=r*Math.PI/180,a=(r-a)*Math.PI/180,i=(l-i)*Math.PI/180,i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e)*Math.cos(n)*Math.sin(i/2)*Math.sin(i/2),i=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),i*=6371e3,console.log(i+"witin"),console.log(o+"witin"),(y=i>1e3*parseInt(o)?(console.log("outside"),!1):(console.log("inside"),!0))||(swiftmoAlert?swiftmoAlert.setContent(c).toggle():alert(c))}),a&&S.removeLayer(a),a=s?L.circle(s,1e3*d):(el=document.querySelector(u),L.circle(JSON.parse(el.dataset.coordinates),parseInt(1e3*el.dataset.radius))),e&&a.addTo(S),a}function F(t,n,e){t=t||[JSON.parse(document.querySelector(u).dataset.coordinates),{lat:f,lng:v}],console.log("baselem"+u);var o,a;document.querySelector(u).dataset.coordinates;E=t[0],console.log("route hit"+JSON.stringify(t[0])),console.log("route hit"+JSON.stringify(t[1])),x&&x.getPlan().setWaypoints([]),o="https://routing.swiftmo.com",a="routing",(x=L.Routing.control({serviceUrl:o,timeout:5e3,profile:a,show:!1,waypoints:t,draggableWaypoints:n,routeWhileDragging:e,createMarker:function(t,e){return L.marker(e.latLng,{draggable:n}).addTo(P)},lineOptions:{styles:[{color:"blue",opacity:1,weight:4,width:"4px"}]}})).on("routingerror",function(t){swiftmoAlert.setContent("Ops, we couldn't find a route between these points").toggle()}),x.on("routeselected",function(t){var e,n,o,a;d=2*(t.route.summary.totalDistance/1e3).toFixed(2),traveltime=(e=d,n=90,e=parseInt(e*n,10),o=Math.floor(e/3600),a=Math.floor(e/60)%60,n=e%60,(e=function(t){return console.log(t.toString().length),1===t.toString().length&&t===a?":0":1===t.toString().length&&t===o?"0":":"})(o)+o+e(a)+a+":"+n),c=parseInt(document.querySelector(u).dataset.travelcharge*d);var i="This requires a "+d+" km return trip taking about "+traveltime+" h.";0!=document.querySelector(u).dataset.travelcharge&&(i+=" This has an added cost of €"+(c/100).toFixed(2)+".");(t.route.summary.totalDistance/1e3).toFixed(1);P._needsClustering[1].bindPopup(L.popup({autoPan:!1}).setContent(function(){var t=document.createElement("div"),e=document.createElement("p");e.textContent=i,t.appendChild(e);e=document.createElement("button");e.classList.add("btn","sms2","autosave","btnnext","confirmDelivery"),e.setAttribute("type","button"),e.dataset.pageid="6",e.textContent="Confirm delivery",t.appendChild(e);e=document.createElement("span");return e.classList.add("glyphicon","glyphicon-ok","conftick2"),t.appendChild(e),t}())).openPopup();var r=document.createElement("div");r.classList.add("emphasis");t=document.createElement("p");t.textContent=i,r.appendChild(t);t=document.createElement("button");t.classList.add("btn","sms2","autosave","btnnext","confirmDelivery"),t.setAttribute("type","button"),t.dataset.pageid="6",t.textContent="Confirm delivery",r.appendChild(t);t=document.createElement("span");for(t.classList.add("glyphicon","glyphicon-ok","conftick2"),r.appendChild(t);g.firstChild;)g.removeChild(g.firstChild);g.appendChild(r)}).addTo(S)}function j(t){var n=[];if("string"==typeof t&&(t=JSON.parse(t)),!1===N)(w=document.createElement("select")).classList.add("rentalTypeSelect"),h.append(w),(O=document.createElement("option")).setAttribute("disabled",!0),O.setAttribute("selected",!0),O.textContent="Select activity type:",w.appendChild(O),N=!0,e(t);else{for(;1<w.children.length;)w.removeChild(w.lastChild);console.log(t),e(t)}function e(t){t.forEach(function(t){t.data.services.forEach(function(t){var e;console.log(t),!1===n.includes(t)&&((e=document.createElement("option")).setAttribute("value",t),e.textContent=t,w.appendChild(e),n.push(t))})}),w.addEventListener("change",function(t){for(var e=I.length-1;0<=e;--e)t.target.value===I[e].type?I[e].providerMarkers.forEach(function(t){P.addLayer(t)}):I[e].providerMarkers.forEach(function(t){P.removeLayer(t)})})}}function z(t){var e="object"!=typeof t?JSON.parse(t):t;!function(n){console.log(JSON.stringify(n));var o=[];n.forEach(function(t,e){t.data.services.forEach(function(t){o.push(t)}),e===n.length-1&&(document.querySelectorAll(".sportCardContainer").forEach(function(t,e){t.style.display="none"}),e=function(t){console.log("UNIQUES"+t);for(var e=[],n=0,o=t.length;n<o;n++)-1===e.indexOf(t[n])&&""!==t[n]&&e.push(t[n]);return e}(o),console.log("uniqueEl"+e),e.forEach(function(t){document.querySelectorAll("[id='"+t+"']").forEach(function(t){t.style.display="block"})}))})}(e);for(var n=0;n<e.length;n++){if(e[n].data.services.length<=1)console.log("one"+e[n]),W(e[n],0);else for(var o=0;o<e[n].data.services.length;o++)console.log("many"+JSON.stringify(e[n])),W(e[n],o);n===e.length-1&&(P.addTo(S),folder2.reattachEvents(),J.addTo(S))}0===e.length&&(console.log("no guides"+e.length),P.clearLayers(),I.length=0)}function V(t,n,e){console.log([...arguments]);var o=S.getBounds();xhr({coordinates:o,sport:t,cards:n},e,function(t){var e;console.log(t),n?(document.getElementById("supplierCardCollection").innerHTML=t,document.getElementById("supplierCardCollection").firstChild.dataset.supplierdata?(z(e=JSON.parse(document.getElementById("supplierCardCollection").firstChild.dataset.supplierdata)),console.log("data"+e),j(e)):j([])):(console.log("callback in 885 "+t),z(t),j(t))})}function W(t,n){var o={};1===t.data.shop.pickup&&(o.data=JSON.parse(JSON.stringify(t.data.shop)),o.data["location-decimal-coordinates"]=t.data.shop["location-decimal-coordinates"]),1===t.data.shop.pickup&&1===t.data.delivery.willtravel&&(o.data=JSON.parse(JSON.stringify(t.data)),o.data["location-decimal-coordinates"]=t.data.shop["location-decimal-coordinates"]),0===t.data.shop.pickup&&1===t.data.delivery.willtravel&&(o.data=JSON.parse(JSON.stringify(t.data.delivery)),o.data["location-decimal-coordinates"]=t.data.delivery["location-decimal-coordinates"]),o.provider=t.provider,o.services=t.data.services,o.verificationcode=t.data.verificationcode;var e=o.data.verificationcode,a=o.data.services[n],t=JSON.stringify(o.data["location-decimal-coordinates"]),i=e+"-"+a+"-"+t;function r(){var t,e;!1===q.includes(i)&&(t=o.data["location-decimal-coordinates"].lat,e=o.data["location-decimal-coordinates"].lng,o.coordinates={lat:t,lng:e},(e=L.circleMarker(o.coordinates,{zIndexOffset:1e3,color:(e=o.data.services[n],console.log("jobType:"+e),"race bike rental"===e?"blue":"mountain bike rental"===e?"green":void 0)})).bindPopup(L.popup({autoPan:!1}).setContent(function(n,t){console.log("972"+n);var e=L.DomUtil.create("div"),o=L.DomUtil.create("h3");o.textContent=n.provider,e.appendChild(o);var a,i=L.DomUtil.create("p"),r=n.data.services[t].replace(/-/g," ");i.textContent=r.charAt(0).toUpperCase()+r.slice(1),e.appendChild(i),_(o=L.DomUtil.create("button","sms2"),["btn","bounceOnHover","mapbtn"]),o.setAttribute("data-guide","card-"+n.data.verificationcode+"-"+n.data.services[t]),o.setAttribute("data-providerCode",n.data.verificationcode),o.textContent="Read more ~",e.appendChild(o),o.addEventListener("click",function(t){console.log(JSON.stringify(n));var e=encodeURI(window.location.origin+"/provider?alias="+n.data.alias);window.location.replace(e)}),n.data.radius&&((a=L.DomUtil.create("button","sms2")).textContent="Activity radius",_(a,["btn","bounceOnHover","radius"]),Y(a,n),e.appendChild(a)),(r=L.DomUtil.create("button","sms2")).textContent="Check route",_(r,["btn","bounceOnHover","checkRoute"]),r.dataset.coordinates=JSON.stringify(n.coordinates),e.appendChild(r),1===n.data.delivery.willtravel&&((i=L.DomUtil.create("button","sms2")).textContent="Delivery Radius",_(i,["btn","bounceOnHover","deliveryRadius"]),o=n.data.delivery["location-decimal-coordinates"],a=n.data.delivery.radius,i.dataset.coordinates=JSON.stringify(o),i.dataset.radius=a,Y(i,{coordinates:o,data:{radius:a}}),e.appendChild(i)),C?((s=L.DomUtil.create("button","sms2")).textContent="next",_(s,["btn","sms2","bounceOnHover","bookguideBtn"]),console.log(n),s.dataset.code=n.data.verificationcode,s.dataset.sport=n.data.services[t]):((s=L.DomUtil.create("button","sms2")).textContent="next",_(s,["btn","sms2","bounceOnHover","btnnext","providers","hirechoice","selectProvider"]),s.dataset.pageid="1",console.log(n),s.dataset.provider=n.provider,s.dataset.hirechoice=n.data.services[t]),e.appendChild(s);var l=L.DomUtil.create("div");_(l,["alertdiv"]),e.appendChild(l);var s=L.DomUtil.create("p");return s.textContent="Please search for a location to route in the panel above",l.appendChild(s),l.style.display="none",r.addEventListener("click",function(){void 0===f||void 0===v?l.style.display="block":F([n.coordinates,{lat:f,lng:v}],!1,!1)}),e}(o,n))).openPopup(),I.push({type:a,providerMarkers:[e]}),e.addTo(P),q.push(i),madeMarkersG=I)}0===I.length?r():I.find(function(t){t.type===a||r()})}function _(t,e){for(var n=0;n<e.length;n++)L.DomUtil.addClass(t,e[n])}function Y(t,e){var n=1;e.radius||(e.radius=1);var o=H(e.coordinates,parseInt(e.data.radius));t.addEventListener("click",function(){console.log("clicked"),n%2?o.addTo(J):o.removeFrom(J),n++})}this.dataRoute=function(t,e,n){var o,a,i;return o=t,a=e,i=n,S.on("load",function(t){console.log("load"),V(o,a,i)}),S.on("moveend",function(t){console.log("moveend"+a),V(o,a,i),0<S.offsetWidth&&S.offsetHeight}),S.on("resize",function(t){0<S.offsetWidth&&0<S.offsetHeight&&V(o,a,i)}),this},this.map=function(){return S},this.notnext=function(){return console.log("notNext"+C),C=!0,console.log("notNext"+C),this},this.removeMap=function(){S.remove()},this.mapcanvas=L.canvas({}),this.generateMap=function(t){var e;return!1===A&&(e=document.createElement("div"),document.querySelector(u).appendChild(e),console.log(u),b=document.createElement("div"),e.appendChild(b),e.style.height=n,e.style.width="100%",S=L.map(e,{layers:[L.tileLayer(t,{attribution:"<a href='https://www.mapbox.com/about/maps/'>Mapbox</a> © <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>"})],preferCanvas:!0,center:[37.09681,-8.41965],zoom:11}),L.control.scale().addTo(S).setPosition("bottomright")),A=!0,this},this.invalidateSize=function(){return S.invalidateSize()},this.returnBounds=function(){return S.getBounds()},this.returnCoordinates=D,this.reverseGeocode=function(t){return function(){var t="https://nominatim.openstreetmap.org/reverse?format=json&lat="+D().lat+"&lon="+D().lng+"&zoom=18&addressdetails=1",e=new XMLHttpRequest;return e.open("GET",t),e.setRequestHeader("Content-Type","application/json"),e.send(),e.onreadystatechange=function(){var t;4===e.readyState&&200===e.status&&(t=JSON.parse(e.responseText),i=t.display_name)},this}()},this.searchLocation=U,this.attachEvents=B,this.assembleButtons=function(t,e,n,o,a,i,r,l,s,d){t=document.querySelector(t),h=t,console.log(t),t.classList.add("emphasis","center"),(g=document.createElement("div")).classList.add("locationOptions"),s&&((c=document.createElement("h2")).classList.add("center","findaguide","item"),c.textContent=s,t.appendChild(c));s=document.createElement("div");s.classList.add("emphasis","block");var c=document.createElement("p");return c.textContent=d,t.appendChild(s),s.appendChild(c),i&&(meetGuide=document.createElement("button"),meetGuide.classList.add("btn","sms2","item","guidePoint","block","center"),meetGuide.textContent="Meet guide at their meetup point",meetGuide.setAttribute("type","button"),meetGuide.addEventListener("click",function(t){t.preventDefault();var e=JSON.parse(document.querySelector(u).dataset.coordinates);f=e[0],v=e[1],k="guidePoint",console.log(k);var n="Coordinates to meet at: "+D().lat+","+D().lng+". Link with directions: ",t=document.createElement("p");t.textContent=n;e=document.createElement("a"),n="https://www.google.com/maps/dir//"+D().lat+","+D().lng;e.setAttribute("href",n),e.setAttribute("target","_blank"),e.textContent="https://www.google.com/maps/dir//"+D().lat+","+D().lng,document.getElementById("coordinates").appendChild(t),t.appendChild(e),e.style.textAlign="center",document.querySelector("#coordinates").scrollIntoView({block:"start",behavior:"smooth"}),document.querySelector("#coordinates").classList.add("infodiv","bounce")}),t.appendChild(meetGuide)),e&&((p=document.createElement("input")).setAttribute("type","text"),p.classList.add("clientLocation","bookguide","item"),p.setAttribute("placeholder","Enter address"),(m=document.createElement("button")).classList.add("btn","btn-primary","sms2","btn-lg"),m.textContent="Search",m.setAttribute("type","button"),n&&(m.id=n),m.addEventListener("click",function(t){t.preventDefault(),k="searchedLocation",U(null,l)}),t.appendChild(p),t.appendChild(m),t.appendChild(g)),o&&(locationBtn=document.createElement("button"),locationBtn.classList.add("btn","sms2","bounceOnHover","item"),locationBtn.textContent="Get your current location",locationBtn.setAttribute("type","button"),a&&(locationBtn.id=n),locationBtn.addEventListener("click",function(t){t.preventDefault(),r?(k="currentLocation",G(S)):(k="currentLocation",G(l))}),t.appendChild(locationBtn)),this},this.geoCodeResult=function(){return i},this.locate=function(t){return G(t),this},this.swapMarker=function(t,e,n,o){return R(t,e,n,o),console.log("markers in obj "+P),this},this.test=function(){P.clearLayers()},this.meetUp=function(){return k},this.addGuideRadius=function(t,e,n,o,a,i){return H(t,e,n,o,a,i),this},this.distance=function(){return d},this.locationValid=function(){return y},this.travelTime=function(){},this.travelCost=function(){return c},this.enableRouting=function(){return console.log("enableroute"),s=!0,this},this.returnProviderCoordinates=function(){return E},this.route=function(t,e,n){return F(t,e,n),this},this.addGuideMarker=function(t,e){return function(t,e){console.log(typeof t),void 0===e&&(e="This guide's meetup point");guidePoint=t?(console.log(S),o=L.marker(t,{draggable:!1}).addTo(S),o.bindPopup(e).openPopup()):(o=L.marker(JSON.parse(document.querySelector(u).dataset.coordinates),{draggable:!1}).addTo(S),o.bindPopup("This guide's meetup point").openPopup())}(t,e),this},this.locateOnClick=function(t,e,n,o){var a,i,r;return a=t,i=e,r=n,S.addEventListener("click",function(t){i&&S.removeLayer(i),0===M?(f=t.latlng.lat,v=t.latlng.lng,k="mapClick",l="Your chosen location",i&&(console.log("inside swap circle"),radius=parseInt(1e3*document.getElementById("trainingradius").value),i=L.circle({lat:t.latlng.lat,lng:t.latlng.lng},radius).addTo(S)),a&&(console.log("inside swap marker"),R()),r&&r()):(f=t.latlng.lat,v=t.latlng.lng,l="Your current location",!0===i&&(radius=parseInt(1e3*document.getElementById("trainingradius").value),i=L.circle({lat:t.latlng.lat,lng:t.latlng.lng},radius).addTo(S)),!0===a&&R(),!0===r&&mapfunctions.saveLocation("coordinates",JSON.stringify({lat:t.latlng.lat,lng:t.latlng.lng}))),s&&F([JSON.parse(document.querySelector(u).dataset.coordinates),{lat:t.latlng.lat,lng:t.latlng.lng}])}),this},this.loadProvidersAndSports=function(t,e,n){return V(t,e,n),this},this.makeSpecificMarker=function(t){makeMarkers2(t,0)},this.loadMarkers=function(t,e){return z(t),this},this.typeDropdown=function(t){return j(t),this}}

